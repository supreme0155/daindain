<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‰∏π‰∏πÊº¢Â†° - Á∑ö‰∏äÈªûÈ§ê</title>
<meta name="color-scheme" content="light dark">
<style>
body{font-family:'Microsoft JhengHei',Arial,sans-serif;background:#fff8f4;}
.header{background:#e74c3c;color:#fff;text-align:center;padding:1.3rem 0 0.8rem;}
.header h1{margin:0 0 4px 0;font-size:2rem;font-weight:bold;}
.header p{margin:0;font-size:1rem;}
.container{max-width:860px;margin:20px auto 0 auto;padding:12px;background:#fff;border-radius:18px;box-shadow:0 4px 16px #e74c3c19;}
.cart-summary{position:fixed;bottom:0;left:0;right:0;background:#fffbe7;border-top:2px solid #ffd580;display:flex;align-items:center;justify-content:space-between;padding:14px 6vw;box-shadow:0 -3px 18px #e67e2280;z-index:99;font-size:1.12rem;}
.cat-note{background:#fff4c2;border-radius:8px;color:#b45b02;font-size:1em;padding:8px 10px 7px 14px;margin:8px 0 10px 0;}
.category{margin-bottom:20px;border-radius:14px;background:#f9f9f9;box-shadow:0 2px 7px #0001;overflow:hidden;}
.category-header{background:#e74c3c;color:#fff;font-size:1.13rem;padding:1rem 1.2rem;font-weight:bold;cursor:pointer;}
.category-header.collapsed{border-radius:14px;}
.category-items{padding:0.4rem 0.9rem 0.7rem 1.2rem;}
.menu-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0 9px 0;border-bottom:1px solid #eee;}
.menu-item:last-child{border-bottom:none;}
.item-info{font-size:1.08rem;font-weight:500;}
.item-controls{display:flex;align-items:center;gap:12px;}
.item-price{font-size:1.1rem;color:#e74c3c;font-weight:bold;}
.quantity-control{display:flex;align-items:center;gap:0.3rem;background:#eee;border-radius:7px;padding:2px 7px;}
.quantity-btn{border:none;background:#ffd700;color:#e74c3c;font-size:1.1rem;width:30px;height:32px;border-radius:7px;font-weight:bold;cursor:pointer;}
.quantity-btn:disabled{opacity:0.5;cursor:not-allowed;}
.quantity{display:inline-block;min-width:1.5em;text-align:center;font-weight:bold;}
@media(max-width:700px){.container{padding:2px;margin:0;}}
</style>
</head>
<body>
<div class="header">
  <h1>üçî ‰∏π‰∏πÊº¢Â†°</h1>
  <p>Á∑ö‰∏äÈªûÈ§êÁ≥ªÁµ±</p>
</div>
<div class="container" id="menuSection">
  <div id="menuContainer"><div class="loading">ËºâÂÖ•ËèúÂñÆ‰∏≠...</div></div>
</div>
<div class="cart-summary" id="cartSummary">
  <div class="cart-info">
    <div class="cart-count">Â∑≤ÈÅ∏ <span id="cartCount">0</span> È†Ö</div>
    <div class="cart-total">Á∏ΩË®à $<span id="cartTotal">0</span></div>
  </div>
  <button class="checkout-btn" id="checkoutBtn" onclick="showCheckout()" disabled>ÂâçÂæÄÁµêÂ∏≥</button>
</div>
<!-- ÁµêÂ∏≥ modal/Ë°®ÂñÆË´ãÁÖß‰Ω†ÂéüÊú¨Ë®≠Ë®àÔºå‰∏çËÆä -->
<script>
// üü¢ È†êË®≠ÂÆåÊï¥ËèúÂñÆÔºàÂõõÂ§ßÂàÜÈ°û„ÄÅÂìÅÈ†Ö/È£≤ÊñôÂÖ®ÈÉ®Â°´Â•ΩÔºâ
const defaultMenuData = [
  {
    category: "Á≤æÈÅ∏ÂÆöÈ£üÈ§ê (ÈôÑ29ÂÖÉÈ£≤Êñô)",
    // note: "‰∏Ä‰ªΩÂ•óÈ§êÈôêÂä†Ë≥º$26Âú∞ÁìúËñØÊ¢ù Êàñ $39Áæ©ÂºèÁ¥ÖÈÜ¨Ê≥¢Êµ™ËñØÔºõÊº¢Â†°ÂèØ+$10Âä†ÂêâÂè∏ (Ëµ∑Âè∏)ÔºõÊó©‰∏ä10ÈªûÂâçÂèØÂä†Ëõã",
    items: [
      { name: "ÊãõÁâåÊº¢Â†°Êéí+ËÖøÁöÆÁÇ∏Èõû+ËÖøÁöÆÈ£Ø", price: 104, drink: "" },
      { name: "È¶ôÈÖ•ÈõûËÖøÊéí+ËÖøÁöÆÁÇ∏Èõû+ËÖøÁöÆÈ£Ø", price: 104, drink: "" },
      { name: "Êº¢Â†°ÊéíË±¨ËÇâÂ†°+ËÖøÁöÆÁÇ∏Èõû+ËÖøÁöÆÈ£Ø", price: 97, drink: "" },
      { name: "ÊãõÁâåÈõûÂ°ä+ËÖøÁöÆÁÇ∏Èõû+ËÖøÁöÆÈ£Ø", price: 104, drink: "" },
      { name: "ÈÆÆÂ´©ÈõûËÖøÂ†°+ÁéâÁ±≥ÊøÉÊπØ", price: 99, drink: "" },
      { name: "ÈÆÆÂ´©ÈõûÁ±≥Ëä±+ËÖøÁöÆÈ£Ø", price: 97, drink: "" },
      { name: "Ëø∑Ëø≠È¶ôÈõû+ËÖøÁöÆÁÇ∏Èõû", price: 107, drink: "" },
      { name: "ÊãõÁâåÊº¢Â†°Êéí+ËÖøÁöÆÈ£Ø+ÁéâÁ±≥ÊøÉÊπØ", price: 114, drink: "" },
      { name: "È¶ôÈÖ•ÈõûËÖøÊéí+ËÖøÁöÆÈ£Ø+ÁéâÁ±≥ÊøÉÊπØ", price: 114, drink: "" },
      { name: "Êº¢Â†°ÊéíË±¨ËÇâÂ†°+ËÖøÁöÆÈ£Ø+ÁéâÁ±≥ÊøÉÊπØ", price: 108, drink: "" },
      { name: "ÈÆÆÂ´©ÈõûËÖøÂ†°+ËÖøÁöÆÈ£Ø+ÁéâÁ±≥ÊøÉÊπØ", price: 107, drink: "" },
      { name: "‰∫îÁ©ÄÈõûËÇâÁ≤•+ÈáëËâ≤ËñØÊ¢ùÈ§ê", price: 94, drink: "" },
      { name: "Ëµ§ËÇâÁæπÈ∫µÁ∑ö+ÈõûÂèØÊ®ÇÈ§Ö", price: 82, drink: "" },
      { name: "È¶ôÈÖ•ÂêâÂàóË±¨ÊéíÂ†°+ÊùèÈÆëËèáÁÇ∏Ê£í", price: 99, drink: "" }
    ]
  },
  // Êó©È§ê
  {
    category: "Êó©ÂÆâÁâπÊÉ†È§ê (ÈôÑ29ÂÖÉÈ£≤Êñô)",
    
    items: [
      { name: "Êº¢Â†°Ëõã+ÈªÉÈáëËñØÊ¢ù", price: 54, drink: "" },
      { name: "ËÖøÁöÆÁÇ∏ÈõûÂ†°+ËñØÈ§Ö", price: 54, drink: "" },
      { name: "ÈÆÆÂ´©ÈõûÁ±≥Ëä±+ËÖøÁöÆÈ£Ø", price: 50, drink: "" },
      { name: "ÊãõÁâåÈõûÂ°ä+ËÖøÁöÆÈ£Ø", price: 50, drink: "" },
      { name: "‰∫îÁ©ÄÈõûËÇâÁ≤•", price: 43, drink: "" },
      { name: "ÈõûËõãÂêêÂè∏+ÈªÉÈáëÈõûÁ±≥Ëä±", price: 43, drink: "" },
      { name: "Â•∂ÈÖ™ÂèØÈ∫óÈ§Ö", price: 28, drink: "" }
    ]
  },
  // ÁæéÂë≥‰∏πÈªû
  {
    category: "ÁæéÂë≥‰∏πÈªû",
    items: [
      { name: "ÊéíÈ™®ÈÖ•ËÇâÁá•È∫µ", price: 68 },
      { name: "Ëµ§ËÇâÁæπÈ∫µÁ∑öÁÖ≤", price: 45 },
      { name: "È¶ôËèáÈõûËÖøÈ£Ø", price: 68 },
      { name: "ÈõûËõãÈ£Ø", price: 41 },
      { name: "ÁéâÁ±≥ÊøÉÊπØ", price: 27 },
      { name: "ÁÑ°È™®ÈõûÂ°ä(9ÂÖ•)", price: 78 },
      { name: "ÈªÉÈáëÈõûÁ±≥Ëä±", price: 47 },
      { name: "ËÖøÁöÆÁÇ∏Èõû", price: 47 },
      { name: "Ë±¨ËÇâÂèØÊ®ÇÈ§Ö", price: 41 },
      { name: "ÈõûÂèØÊ®ÇÈ§Ö", price: 41 },
      { name: "ÈõûÁ±≥Ëä±", price: 37 },
      { name: "ÈÆÆÂ´©ÈõûËÖøÂ†°", price: 66 },
      { name: "È¶ôÈÖ•ÂêâÂàóË±¨ÊéíÂ†°", price: 66 },
      { name: "ÈõûËõãÂêêÂè∏", price: 37 },
      { name: "ÈªÉÈáëËñØÊ¢ù", price: 41 },
      { name: "Á¥ÖËóúÊ≥¢Êµ™ËñØ", price: 36 },
      { name: "ËñØÈ§Ö", price: 23 },
      { name: "ÊùèÈÆëËèáÁÇ∏Ê£í", price: 41 }
    ]
  },
  // È£≤ÂìÅ
  {
  category: "È£≤ÂìÅ",
  items: [
    { name: "ÂèØÊ®Ç(‰∏≠)", price: 29 },
    { name: "ÂèØÊ®Ç(Â§ß)", price: 34 },
    { name: "Ê±ΩÊ∞¥(‰∏≠)", price: 29 },
    { name: "Ê±ΩÊ∞¥(Â§ß)", price: 34 },
    { name: "Èå´Ëò≠Á¥ÖËå∂(‰∏≠)", price: 29 },
    { name: "Èå´Ëò≠Á¥ÖËå∂(Â§ß)", price: 34 },
    { name: "ËòãÊûúÊ±Å(‰∏≠)", price: 29 },
    { name: "ËòãÊûúÊ±Å(Â§ß)", price: 34 },
    { name: "Âè∞ÁÅ£ÁÉèÈæç(ÁÑ°Á≥ñ)(‰∏≠)", price: 29 },
    { name: "Âè∞ÁÅ£ÁÉèÈæç(ÁÑ°Á≥ñ)(Â§ß)", price: 34 },
    { name: "Á¥ÖËå∂ÁâõÂ•∂(‰∏≠)", price: 29 },
    { name: "Á¥ÖËå∂ÁâõÂ•∂(Â§ß)", price: 34 },
    { name: "ÁÜ±Ê°ÇËä±ÁÉèÈæç", price: 29 },
    { name: "ÁÜ±ÁæéÂºè(Êñ∞ÂìÅ)", price: 29 }
  ]
  }
];

// üü¢ menuData Á∏ΩÊòØÊúâË≥áÊñôÔºàlocalStorage Ê≤íÊúâÊàñÊ†ºÂºèÈåØË™§ÊúÉËá™Âãï fallback È†êË®≠Ôºâ
let menuData;
try {
    menuData = JSON.parse(localStorage.getItem('dandan_menu'));
    if(!menuData || !Array.isArray(menuData) || !menuData[0]?.category) throw "no menu";
} catch(e) {
    menuData = defaultMenuData;
}
let cart = {};
let collapsedCat = {};
window.addEventListener('load', () => {
  displayMenu();
  updateCartDisplay();
  adjustContainerPadding();
});
window.addEventListener('resize', adjustContainerPadding);
// üü¢ Ëá™ÂãïË£úÂ∫ïÈÉ®Á©∫Èñì
function adjustContainerPadding() {
  const cart = document.getElementById('cartSummary');
  const container = document.getElementById('menuSection');
  if(cart && container) {
    cart.style.visibility = "hidden"; cart.style.display = "block";
    setTimeout(function() {
      const h = cart.offsetHeight || 90;
      container.style.paddingBottom = (h + 20) + "px";
      cart.style.visibility = ""; cart.style.display = "";
    }, 40);
  }
}
function displayMenu() {
  const container = document.getElementById('menuContainer');
  if (!menuData.length) {
    container.innerHTML = '<div class="error">Êö´ÁÑ°ËèúÂñÆË≥áÊñô</div>';
    return;
  }
  let html = menuData.map((category, ci) => {
    const items = (category.items || []);
    const colKey = category.category;
    const collapsed = collapsedCat[colKey] === true;
    return `
      <div class="category">
        <div class="category-header${collapsed ? ' collapsed' : ''}" onclick="toggleCat('${colKey}')">
          ${category.category} <span style="font-size:0.98em;float:right;">${collapsed ? 'Ôºã' : 'Ôºç'}</span>
        </div>
        ${category.note ? `<div class="cat-note">${category.note}</div>` : ''}
        <div class="category-items" style="display:${collapsed ? 'none' : 'block'};">
          ${items.map((item, iidx) => `
            <div class="menu-item">
              <div class="item-info">${item.name}</div>
              <div class="item-controls">
                <div class="item-price">$${item.price}</div>
                ${(typeof item.drink !== "undefined") ? renderDrinkSelect(ci,iidx,item.drink) : ""}
                <div class="quantity-control">
                  <button class="quantity-btn" onclick="updateQuantity('${ci}-${iidx}', -1)" ${!cart[ci+'-'+iidx] ? 'disabled' : ''}>-</button>
                  <span class="quantity">${cart[ci+'-'+iidx] || 0}</span>
                  <button class="quantity-btn" onclick="updateQuantity('${ci}-${iidx}', 1)">+</button>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }).join('');
  container.innerHTML = html;
}
function renderDrinkSelect(ci,iidx,selected){
  const drinkOptions = [
    "Á¥ÖËå∂(ÂÜ∞/ÁÜ±)", "Â•∂Ëå∂(ÂÜ∞/ÁÜ±)", "ÁÉèÈæçËå∂", "ËòãÊûúÊ±Å", "ÁæéÂºèÂíñÂï°", "Â∑ßÂÖãÂäõ(ÂÜ∞/ÁÜ±)",
    "ÁéâÁ±≥ÊøÉÊπØ", "ÈáëÊ°îÊ™∏Ê™¨Ê∞£Ê≥°È£≤", "ÂÜ∞Á¥ÖËå∂(Â§ß)", "ÂÜ∞Á¥ÖËå∂(Â∞è)", "ÂíñÂï°(ÁÜ±/ÂÜ∞)"
  ];
  let opts = drinkOptions.map(d => `<option value="${d}"${selected===d?' selected':''}>${d}</option>`).join('');
  return `<select onchange="selectDrink('${ci}-${iidx}',this.value)">
    <option value="">--È£≤Êñô--</option>${opts}
  </select>`;
}
function selectDrink(key, val){
  const [ci,iidx] = key.split('-').map(x=>parseInt(x,10));
  menuData[ci].items[iidx].drink = val;
}
function toggleCat(key) {
  collapsedCat[key] = !collapsedCat[key];
  displayMenu();
}
function updateQuantity(key, change) {
  if (!cart[key]) cart[key] = 0;
  cart[key] += change;
  if (cart[key] <= 0) delete cart[key];
  updateCartDisplay();
  displayMenu();
}
function updateCartDisplay() {
  let totalItems = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
  let totalPrice = 0;
  Object.entries(cart).forEach(([key, qty]) => {
    const [ci,iidx] = key.split('-').map(x=>parseInt(x,10));
    const item = menuData[ci]?.items?.[iidx];
    if(item) totalPrice += (item.price || 0) * qty;
  });
  document.getElementById('cartCount').textContent = totalItems;
  document.getElementById('cartTotal').textContent = totalPrice;
  document.getElementById('checkoutBtn').disabled = totalItems === 0;
}
// ...ÂÖ∂È§òÁµêÂ∏≥„ÄÅË°®ÂñÆ„ÄÅlocalStorageË®ÇÂñÆÂÑ≤Â≠òËàáÂéüÊú¨Áõ∏Âêå...
</script>
</body>
</html>
