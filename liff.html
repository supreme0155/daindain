<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸¹ä¸¹æ¼¢å ¡ - ç·šä¸Šé»é¤</title>
<meta name="color-scheme" content="light dark">
<style>
body{font-family:'Microsoft JhengHei',Arial,sans-serif;background:#fff8f4;}
.header{background:#e74c3c;color:#fff;text-align:center;padding:1.3rem 0 0.8rem;}
.header h1{margin:0 0 4px 0;font-size:2rem;font-weight:bold;}
.header p{margin:0;font-size:1rem;}
.container{max-width:860px;margin:20px auto 0 auto;padding:12px;background:#fff;border-radius:18px;box-shadow:0 4px 16px #e74c3c19;}
.cart-summary{position:fixed;bottom:0;left:0;right:0;background:#fffbe7;border-top:2px solid #ffd580;display:flex;align-items:center;justify-content:space-between;padding:14px 6vw;box-shadow:0 -3px 18px #e67e2280;z-index:99;font-size:1.12rem;}
.cat-note{background:#fff4c2;border-radius:8px;color:#b45b02;font-size:1em;padding:8px 10px 7px 14px;margin:8px 0 10px 0;}
.category{margin-bottom:20px;border-radius:14px;background:#f9f9f9;box-shadow:0 2px 7px #0001;overflow:hidden;}
.category-header{background:#e74c3c;color:#fff;font-size:1.13rem;padding:1rem 1.2rem;font-weight:bold;cursor:pointer;}
.category-header.collapsed{border-radius:14px;}
.category-items{padding:0.4rem 0.9rem 0.7rem 1.2rem;}
.menu-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0 9px 0;border-bottom:1px solid #eee;}
.menu-item:last-child{border-bottom:none;}
.item-info{font-size:1.08rem;font-weight:500;}
.item-controls{display:flex;align-items:center;gap:12px;}
.item-price{font-size:1.1rem;color:#e74c3c;font-weight:bold;}
.quantity-control{display:flex;align-items:center;gap:0.3rem;background:#eee;border-radius:7px;padding:2px 7px;}
.quantity-btn{border:none;background:#ffd700;color:#e74c3c;font-size:1.1rem;width:30px;height:32px;border-radius:7px;font-weight:bold;cursor:pointer;}
.quantity-btn:disabled{opacity:0.5;cursor:not-allowed;}
.quantity{display:inline-block;min-width:1.5em;text-align:center;font-weight:bold;}
/* Modal æ¨£å¼ */
.modal{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:1000;}
.modal-content{background:#fff;padding:2rem 1.7rem 1.4rem 1.7rem;border-radius:14px;max-width:390px;width:97vw;margin:10vh auto;box-shadow:0 8px 32px #0002;position:relative;}
.close{position:absolute;top:0.7rem;right:1.1rem;font-size:1.6rem;color:#e74c3c;cursor:pointer;font-weight:bold;}
@media(max-width:700px){.container{padding:2px;margin:0;}}
</style>
</head>
<body>
<div class="header">
  <h1>ğŸ” ä¸¹ä¸¹æ¼¢å ¡</h1>
  <p>ç·šä¸Šé»é¤ç³»çµ±</p>
</div>
<div class="container" id="menuSection">
  <div id="menuContainer"><div class="loading">è¼‰å…¥èœå–®ä¸­...</div></div>
</div>
<div class="cart-summary" id="cartSummary">
  <div class="cart-info">
    <div class="cart-count">å·²é¸ <span id="cartCount">0</span> é …</div>
    <div class="cart-total">ç¸½è¨ˆ $<span id="cartTotal">0</span></div>
  </div>
  <button class="checkout-btn" id="checkoutBtn" onclick="showCheckout()" disabled>å‰å¾€çµå¸³</button>
</div>

<!-- ğŸŸ¢ Modalï¼šçµå¸³ -->
<div class="modal" id="checkoutModal">
  <div class="modal-content">
    <span class="close" onclick="closeCheckout()">&times;</span>
    <h2 style="color:#e74c3c;margin-bottom:0.7em;">çµå¸³è³‡æ–™</h2>
    <form id="orderForm">
      <div style="margin-bottom:0.9em;">
        <label>å§“å*<br>
        <input type="text" id="customerName" required style="width:100%;padding:8px;border-radius:5px;"></label>
      </div>
      <div style="margin-bottom:0.9em;">
        <label>é›»è©±*<br>
        <input type="tel" id="customerPhone" required style="width:100%;padding:8px;border-radius:5px;"></label>
      </div>
      <div style="margin-bottom:0.8em;">
        <label>å‚™è¨»<br>
        <input type="text" id="customerNote" style="width:100%;padding:8px;border-radius:5px;"></label>
      </div>
      <div style="font-size:1.07em;margin-bottom:1.1em;">
        <strong>è¨‚å–®æ˜ç´°ï¼š</strong><br>
        <div id="orderSummary"></div>
        <div style="margin-top:0.7em;font-weight:bold;">ç¸½è¨ˆï¼š$<span id="orderSumTotal"></span></div>
      </div>
      <div id="orderError" style="color:#e74c3c;margin-bottom:0.5em;display:none;"></div>
      <button type="submit" class="checkout-btn" style="width:100%;">é€å‡ºè¨‚å–®</button>
    </form>
  </div>
</div>

<!-- ğŸŸ¢ Modalï¼šé€å‡ºå®Œæˆ -->
<div class="modal" id="orderSuccessModal">
  <div class="modal-content" style="text-align:center;">
    <h2 style="color:#2ecc71;">âœ… è¨‚å–®å·²é€å‡º</h2>
    <div style="margin:1.5em 0 1em 0;">æ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼<br>è«‹è‡³æ«ƒæª¯ç­‰å€™å–é¤ã€‚</div>
    <button class="checkout-btn" style="width:70%;" onclick="closeSuccess()">ç¢ºå®š</button>
  </div>
</div>

<script>
// === ğŸŸ¢ é è¨­èœå–®ï¼šå¯ç”¨ menu.html è‡ªè¨‚æ›´æ–° ===
const defaultMenuData = [
  {
    category: "ç²¾é¸å®šé£Ÿé¤ (é™„29å…ƒé£²æ–™)",
    note: "ä¸€ä»½å¥—é¤é™åŠ è³¼$26åœ°ç“œè–¯æ¢ æˆ– $39ç¾©å¼ç´…é†¬æ³¢æµªè–¯ï¼›æ¼¢å ¡å¯+$10åŠ å‰å¸ (èµ·å¸)ï¼›æ—©ä¸Š10é»å‰å¯åŠ è›‹",
    items: [
      { name: "æ‹›ç‰Œæ¼¢å ¡æ’+è…¿çš®ç‚¸é›+è…¿çš®é£¯", price: 104, drink: "" },
      { name: "é¦™é…¥é›è…¿æ’+è…¿çš®ç‚¸é›+è…¿çš®é£¯", price: 104, drink: "" },
      { name: "æ¼¢å ¡æ’è±¬è‚‰å ¡+è…¿çš®ç‚¸é›+è…¿çš®é£¯", price: 97, drink: "" },
      { name: "æ‹›ç‰Œé›å¡Š+è…¿çš®ç‚¸é›+è…¿çš®é£¯", price: 104, drink: "" },
      { name: "é®®å«©é›è…¿å ¡+ç‰ç±³æ¿ƒæ¹¯", price: 99, drink: "" },
      { name: "é®®å«©é›ç±³èŠ±+è…¿çš®é£¯", price: 97, drink: "" },
      { name: "è¿·è¿­é¦™é›+è…¿çš®ç‚¸é›", price: 107, drink: "" },
      { name: "æ‹›ç‰Œæ¼¢å ¡æ’+è…¿çš®é£¯+ç‰ç±³æ¿ƒæ¹¯", price: 114, drink: "" },
      { name: "é¦™é…¥é›è…¿æ’+è…¿çš®é£¯+ç‰ç±³æ¿ƒæ¹¯", price: 114, drink: "" },
      { name: "æ¼¢å ¡æ’è±¬è‚‰å ¡+è…¿çš®é£¯+ç‰ç±³æ¿ƒæ¹¯", price: 108, drink: "" },
      { name: "é®®å«©é›è…¿å ¡+è…¿çš®é£¯+ç‰ç±³æ¿ƒæ¹¯", price: 107, drink: "" },
      { name: "äº”ç©€é›è‚‰ç²¥+é‡‘è‰²è–¯æ¢é¤", price: 94, drink: "" },
      { name: "èµ¤è‚‰ç¾¹éºµç·š+é›å¯æ¨‚é¤…", price: 82, drink: "" },
      { name: "é¦™é…¥å‰åˆ—è±¬æ’å ¡+æé®‘è‡ç‚¸æ£’", price: 99, drink: "" }
    ]
  },
  {
    category: "æ—©å®‰ç‰¹æƒ é¤ (é™„29å…ƒé£²æ–™)",
    note: "ä¸€ä»½å¥—é¤é™åŠ è³¼$26åœ°ç“œè–¯æ¢ æˆ– $39ç¾©å¼ç´…é†¬æ³¢æµªè–¯ï¼›æ¼¢å ¡å¯+$10åŠ å‰å¸ (èµ·å¸)ï¼›æ—©ä¸Š10é»å‰å¯åŠ è›‹",
    items: [
      { name: "æ¼¢å ¡è›‹+é»ƒé‡‘è–¯æ¢", price: 54, drink: "" },
      { name: "è…¿çš®ç‚¸é›å ¡+è–¯é¤…", price: 54, drink: "" },
      { name: "é®®å«©é›ç±³èŠ±+è…¿çš®é£¯", price: 50, drink: "" },
      { name: "æ‹›ç‰Œé›å¡Š+è…¿çš®é£¯", price: 50, drink: "" },
      { name: "äº”ç©€é›è‚‰ç²¥", price: 43, drink: "" },
      { name: "é›è›‹åå¸+é»ƒé‡‘é›ç±³èŠ±", price: 43, drink: "" },
      { name: "å¥¶é…ªå¯éº—é¤…", price: 28, drink: "" }
    ]
  },
  {
    category: "ç¾å‘³ä¸¹é»",
    items: [
      { name: "æ’éª¨é…¥è‚‰ç‡¥éºµ", price: 68 },
      { name: "èµ¤è‚‰ç¾¹éºµç·šç…²", price: 45 },
      { name: "é¦™è‡é›è…¿é£¯", price: 68 },
      { name: "é›è›‹é£¯", price: 41 },
      { name: "ç‰ç±³æ¿ƒæ¹¯", price: 27 },
      { name: "ç„¡éª¨é›å¡Š(9å…¥)", price: 78 },
      { name: "é»ƒé‡‘é›ç±³èŠ±", price: 47 },
      { name: "è…¿çš®ç‚¸é›", price: 47 },
      { name: "è±¬è‚‰å¯æ¨‚é¤…", price: 41 },
      { name: "é›å¯æ¨‚é¤…", price: 41 },
      { name: "é›ç±³èŠ±", price: 37 },
      { name: "é®®å«©é›è…¿å ¡", price: 66 },
      { name: "é¦™é…¥å‰åˆ—è±¬æ’å ¡", price: 66 },
      { name: "é›è›‹åå¸", price: 37 },
      { name: "é»ƒé‡‘è–¯æ¢", price: 41 },
      { name: "ç´…è—œæ³¢æµªè–¯", price: 36 },
      { name: "è–¯é¤…", price: 23 },
      { name: "æé®‘è‡ç‚¸æ£’", price: 41 }
    ]
  },
  // é£²å“ï¼ˆå¯æ ¹æ“šä½ çš„æœ€æ–°åƒ¹æ ¼è¡¨è£œé½Šï¼‰
  {
    category: "é£²å“",
    items: [
      { name: "å¯æ¨‚(ä¸­)", price: 29 },
      { name: "å¯æ¨‚(å¤§)", price: 34 },
      { name: "æ±½æ°´(ä¸­)", price: 29 },
      { name: "æ±½æ°´(å¤§)", price: 34 },
      { name: "éŒ«è˜­ç´…èŒ¶(ä¸­)", price: 29 },
      { name: "éŒ«è˜­ç´…èŒ¶(å¤§)", price: 34 },
      { name: "è˜‹æœæ±(ä¸­)", price: 29 },
      { name: "è˜‹æœæ±(å¤§)", price: 34 },
      { name: "å°ç£çƒé¾(ç„¡ç³–)(ä¸­)", price: 29 },
      { name: "å°ç£çƒé¾(ç„¡ç³–)(å¤§)", price: 34 },
      { name: "ç´…èŒ¶ç‰›å¥¶(ä¸­)", price: 29 },
      { name: "ç´…èŒ¶ç‰›å¥¶(å¤§)", price: 34 },
      { name: "ç†±æ¡‚èŠ±çƒé¾", price: 29 },
      { name: "ç†±ç¾å¼(æ–°å“)", price: 29 }
    ]
  }
];

// === ğŸŸ¢ èœå–®è¼‰å…¥ ===
let menuData;
try {
    menuData = JSON.parse(localStorage.getItem('dandan_menu'));
    if(!menuData || !Array.isArray(menuData) || !menuData[0]?.category) throw "no menu";
} catch(e) {
    menuData = defaultMenuData;
}
let cart = {};
let collapsedCat = {};
window.addEventListener('load', () => {
  displayMenu();
  updateCartDisplay();
  adjustContainerPadding();
});
window.addEventListener('resize', adjustContainerPadding);
// === ğŸŸ¢ è‡ªå‹•è£œåº•éƒ¨ç©ºé–“ ===
function adjustContainerPadding() {
  const cart = document.getElementById('cartSummary');
  const container = document.getElementById('menuSection');
  if(cart && container) {
    cart.style.visibility = "hidden"; cart.style.display = "block";
    setTimeout(function() {
      const h = cart.offsetHeight || 90;
      container.style.paddingBottom = (h + 20) + "px";
      cart.style.visibility = ""; cart.style.display = "";
    }, 40);
  }
}
function displayMenu() {
  const container = document.getElementById('menuContainer');
  if (!menuData.length) {
    container.innerHTML = '<div class="error">æš«ç„¡èœå–®è³‡æ–™</div>';
    return;
  }
  let html = menuData.map((category, ci) => {
    const items = (category.items || []);
    const colKey = category.category;
    const collapsed = collapsedCat[colKey] === true;
    return `
      <div class="category">
        <div class="category-header${collapsed ? ' collapsed' : ''}" onclick="toggleCat('${colKey}')">
          ${category.category} <span style="font-size:0.98em;float:right;">${collapsed ? 'ï¼‹' : 'ï¼'}</span>
        </div>
        ${category.note ? `<div class="cat-note">${category.note}</div>` : ''}
        <div class="category-items" style="display:${collapsed ? 'none' : 'block'};">
          ${items.map((item, iidx) => `
            <div class="menu-item">
              <div class="item-info">${item.name}</div>
              <div class="item-controls">
                <div class="item-price">$${item.price}</div>
                ${(typeof item.drink !== "undefined") ? renderDrinkSelect(ci,iidx,item.drink) : ""}
                <div class="quantity-control">
                  <button class="quantity-btn" onclick="updateQuantity('${ci}-${iidx}', -1)" ${!cart[ci+'-'+iidx] ? 'disabled' : ''}>-</button>
                  <span class="quantity">${cart[ci+'-'+iidx] || 0}</span>
                  <button class="quantity-btn" onclick="updateQuantity('${ci}-${iidx}', 1)">+</button>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }).join('');
  container.innerHTML = html;
}
function renderDrinkSelect(ci,iidx,selected){
  const drinkOptions = [
    "å¯æ¨‚(ä¸­)", "å¯æ¨‚(å¤§)", "æ±½æ°´(ä¸­)", "æ±½æ°´(å¤§)", "éŒ«è˜­ç´…èŒ¶(ä¸­)", "éŒ«è˜­ç´…èŒ¶(å¤§)",
    "è˜‹æœæ±(ä¸­)", "è˜‹æœæ±(å¤§)", "å°ç£çƒé¾(ç„¡ç³–)(ä¸­)", "å°ç£çƒé¾(ç„¡ç³–)(å¤§)",
    "ç´…èŒ¶ç‰›å¥¶(ä¸­)", "ç´…èŒ¶ç‰›å¥¶(å¤§)", "ç†±æ¡‚èŠ±çƒé¾", "ç†±ç¾å¼(æ–°å“)"
  ];
  let opts = drinkOptions.map(d => `<option value="${d}"${selected===d?' selected':''}>${d}</option>`).join('');
  return `<select onchange="selectDrink('${ci}-${iidx}',this.value)">
    <option value="">--é£²æ–™--</option>${opts}
  </select>`;
}
function selectDrink(key, val){
  const [ci,iidx] = key.split('-').map(x=>parseInt(x,10));
  menuData[ci].items[iidx].drink = val;
}
function toggleCat(key) {
  collapsedCat[key] = !collapsedCat[key];
  displayMenu();
}
function updateQuantity(key, change) {
  if (!cart[key]) cart[key] = 0;
  cart[key] += change;
  if (cart[key] <= 0) delete cart[key];
  updateCartDisplay();
  displayMenu();
}
function updateCartDisplay() {
  let totalItems = Object.values(cart).reduce((sum, qty) => sum + qty, 0);
  let totalPrice = 0;
  Object.entries(cart).forEach(([key, qty]) => {
    const [ci,iidx] = key.split('-').map(x=>parseInt(x,10));
    const item = menuData[ci]?.items?.[iidx];
    if(item) totalPrice += (item.price || 0) * qty;
  });
  document.getElementById('cartCount').textContent = totalItems;
  document.getElementById('cartTotal').textContent = totalPrice;
  document.getElementById('checkoutBtn').disabled = totalItems === 0;
}

// === ğŸŸ¢ çµå¸³æµç¨‹ ===
function showCheckout() {
    // é¡¯ç¤º modal
    document.getElementById('checkoutModal').style.display = 'block';
    // è¨‚å–®æ˜ç´°
    let summaryArr = Object.entries(cart).map(([key, qty]) => {
        const [ci,iidx] = key.split('-').map(x=>parseInt(x,10));
        const item = menuData[ci]?.items?.[iidx];
        if(!item) return '';
        let str = item.name;
        if(typeof item.drink !== "undefined" && item.drink) str += `ï¼ˆ${item.drink}ï¼‰`;
        return str + ` Ã—${qty} = $${item.price*qty}`;
    });
    document.getElementById('orderSummary').innerHTML = summaryArr.map(s=>`<div>${s}</div>`).join('');
    // ç¸½åƒ¹
    let total = Object.entries(cart).reduce((sum, [key, qty]) => {
        const [ci,iidx] = key.split('-').map(x=>parseInt(x,10));
        const item = menuData[ci]?.items?.[iidx];
        return sum + (item ? item.price*qty : 0);
    }, 0);
    document.getElementById('orderSumTotal').textContent = total;
    document.getElementById('orderError').style.display = "none";
}
function closeCheckout() {
    document.getElementById('checkoutModal').style.display = 'none';
}
document.getElementById('orderForm').addEventListener('submit', function(e){
    e.preventDefault();
    // æª¢æŸ¥
    const name = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    const note = document.getElementById('customerNote').value.trim();
    if(!name || !phone){
        document.getElementById('orderError').textContent = "è«‹è¼¸å…¥å§“åå’Œé›»è©±";
        document.getElementById('orderError').style.display = "";
        return;
    }
    // çµ„è¨‚å–®è³‡æ–™
    let orderItems = Object.entries(cart).map(([key, qty]) => {
        const [ci,iidx] = key.split('-').map(x=>parseInt(x,10));
        const item = menuData[ci]?.items?.[iidx];
        if(!item) return null;
        return {
            name: item.name,
            price: item.price,
            drink: (typeof item.drink !== "undefined") ? item.drink : undefined,
            quantity: qty
        }
    }).filter(Boolean);
    let total = orderItems.reduce((sum, i) => sum + i.price*i.quantity, 0);
    // å¯«é€² localStorage
    let allOrders = [];
    try { allOrders = JSON.parse(localStorage.getItem('dandan_orders')||'[]'); } catch(e){}
    allOrders.push({
        order_number: 'D' + Date.now(),
        customer_name: name,
        customer_phone: phone,
        note: note,
        items: orderItems,
        created_at: new Date().toISOString(),
        total
    });
    localStorage.setItem('dandan_orders', JSON.stringify(allOrders));
    // æ¸…ç©ºè³¼ç‰©è»Š
    cart = {};
    updateCartDisplay();
    closeCheckout();
    document.getElementById('orderSuccessModal').style.display = 'block';
});
function closeSuccess(){
    document.getElementById('orderSuccessModal').style.display = 'none';
    // å¯é‡æ–°æ•´ç†æˆ–è·³è½‰
}
</script>
</body>
</html>
